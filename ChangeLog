2008-06-24  Olav Vitters  <olav@bkor.dhs.org>

	* mango/views.py (edit_user, add_account, list_mirrors, edit_mirror,
	  add_mirror): Name the variables more consistently.

2008-06-24  Olav Vitters  <olav@bkor.dhs.org>

	* mango/models.py (Foundationmembers, FoundationmembersForm,): Require
	certain Foundationmembers model fields to be filled in. Correct the
	name of the FoundationmembersForm.
	* mango/urls.py: Add URL for the edit_foundationmember view.
	* mango/views.py (add_foundationmember_to_xml, list_foundationmembers,
	  edit_foundationmember, list_modules): Create new function
	  add_foundationmember_to_xml. This either uses the form information
	  or the form instance to add the member to the XML. Create a new view
	  called edit_foundationmember, allowing a foundationmember record to
	  be updated.
	* www/list_foundationmembers.xsl: Correct links to the
	edit_foundationmember view.
	* www/update_foundationmember.xsl: Correct link to
	edit_foundationmember view.

2008-06-24  Olav Vitters  <olav@bkor.dhs.org>

	* mango/models.py (Foundationmembers): Add is_member and need_to_renew
	properties.
	* mango/views.py (list_foundationmembers): Add missing information to
	the XML.

2008-06-24  Olav Vitters  <olav@bkor.dhs.org>

	* mango/views.py (list_accounts): Add paginator to account request
	overview. Further, only show pending setup accounts. Currently not
	possible to change that.

2008-06-23  Olav Vitters  <olav@bkor.dhs.org>

	* mango/models.py (Users.add_to_xml, Modules, Modules.maintainer,
	  Modules.add_to_xml, L10nModules): Fix Users.add_to_xml to actually
	  work. For Modules, maintainerUid is a MULTI_ATTR, not memberUid.
	  Further, add a maintainer property (joins maintainerUid together).
	  Finally, add an add_to_xml helper function.
	* mango/urls.py: Add list_modules view to configuration. Also change
	the way existing views are referenced.
	* mango/views.py (list_modules): New view. Shows modules.
	* www/list_modules.xsl: Update scriptname so that links point to the
	right place.

2008-06-23  Olav Vitters  <olav@bkor.dhs.org>

	* INSTALL: Add some short incomplete notes about the Python (Django)
	port.

2008-06-23  Olav Vitters  <olav@bkor.dhs.org>

	* mango/models.py (LdapObject.search, Users.groups): Remove leftover
	debug message. Further, optimize use of LDAP queries by only
	requesting the cn of groups within the Users class.

2008-06-23  Olav Vitters  <olav@bkor.dhs.org>

	* mango/views.py (list_users): Add pagination to list_users. This is
	way more inefficient than normal models as LdapObject actually creates
	an instance for every user, no matter if it is needed by the paginator
	or not.
	* www/list_users.xsl: Correct link to list_users view.

2008-06-23  Olav Vitters  <olav@bkor.dhs.org>

	* mango/views.py (list_mirrors): Show mirrors per page (25).
	* www/list_ftpmirrors.xsl: Correct link to list_mirrors view.

2008-06-23  Olav Vitters  <olav@bkor.dhs.org>

	Even more fixes due to introduction of Q.

	* mango/models.py (Modules, L10nModules):
	* mango/views.py (list_users):

2008-06-23  Olav Vitters  <olav@bkor.dhs.org>

	* mango/views.py (add_account): Fix title used in document.

2008-06-23  Olav Vitters  <olav@bkor.dhs.org>

	Fix regressions due to instruction of new method to search LDAP (SVN
	revision 237).

	* mango/models.py (UserGroups, Users.groups): Add default filter to
	UserGroups. Update groups function to ensure the filter uses a Q
	object.
	* mango/views.py (get_xmldoc, edit_user): Use Q when providing a
	filter for LDAP.

2008-06-23  Olav Vitters  <olav@bkor.dhs.org>

	* mango/models.py (AccountsForm: Add new Form, derived from the
	AccountRequest model.

2008-06-23  Olav Vitters  <olav@bkor.dhs.org>

	* HACKING: Update HACKING with current design thoughts and a TODO
	list (incomplete).

2008-06-23  Olav Vitters  <olav@bkor.dhs.org>

	* mango/models.py (LdapObject, LdapObject.search, LdapObject.method,
	  LdapObject._build_filter, Users, Modules, L10nModules, DevModules):
	  Add a _build_filter function to LdapObject. This converts a query
	  filter made up by 'Q' to an ldap filter. It also handles quoting,
	  AND, OR and NOT. Change the LdapObject search function to make use
	  of _build_filter.
	  Further, allow an LdapObject derived class to have a predefined
	  filter. This filter will be AND'ed together with any filters
	  provides to the LdapObject search function.
	  Set default FILTER for Users class. Further, create two new classes
	  derived from Module class; L10nModules and DevModules. Each of these
	  classes has a filter which only returns a certain module.
	* mango/views.py (add_account): Instead of providing a filter to the
	  Modules class, use the newly created L10nModules and DevModules
	  classes.

2008-06-23  Olav Vitters  <olav@bkor.dhs.org>

	* mango/models.py (Ftpmirrors.ault): Make mirror active by default.
	* mango/urls.py: Make add_mirror view available as
	/foundationmembers/add/.
	* mango/views.py (add_mirror): New function. Add a new mirror. Upon
	saving it will redirect so the mirror can be updated.
	* www/new_ftpmirror.xsl: Update URL to reflect Django changes.

2008-06-23  Olav Vitters  <olav@bkor.dhs.org>

	* mango/views.py (add_form_errors_to_xml, edit_mirror): Add new
	function which checks if the form is valid. If not, it adds the errors
	to the XML. Needs to be renamed to better clarify what it does. In
	edit_mirror, make use of this helper function.
	* www/list_ftpmirrors.xsl: Update link to new ftp mirror to follow
	Django style.

2008-06-22  Olav Vitters  <olav@bkor.dhs.org>

	* mango/models.py (Foundationmembers, Ftpmirrors): Ensure first_added
	will have the current date. Update the Ftpmirrors to use more specific
	model fields (allowing Django to verify it).

2008-06-22  Olav Vitters  <olav@bkor.dhs.org>

	* mango/models.py (Modules): Add Modules class, reflecting the modules
	in LDAP.
	* mango/urls.py: Make add_account view available as /requests/add/
	* mango/views.py (add_account): Do the bare minimum to have the XSLT
	template display the form. Submitting doesn't work at this stage.

2008-06-22  Olav Vitters  <olav@bkor.dhs.org>

	* mango/urls.py: Enable fake view_index (doesn't do anything).
	* mango/views.py (view_index): Rename test_index to view_index

2008-06-22  Olav Vitters  <olav@bkor.dhs.org>

	* mango/models.py (Foundationmembers.Meta): Order the foundation
	members by lastname, then firstname. This like the PHP version.

2008-06-22  Olav Vitters  <olav@bkor.dhs.org>

	* mango/views.py (edit_mirror, list_foundationmembers): Make use of
	get_object_or_404. Also give 404 error message when invalid page was
	given.
	* www/list_foundationmembers.xsl: Make script variable '.'. This as
	Django appears as directories.

2008-06-22  Olav Vitters  <olav@bkor.dhs.org>

	* mango/views.py (add_paginator_to_xml, list_accounts,
	  list_foundationmembers): Paginate results from a query. Add
	  paginated entries to the XML by use of the add_paginator_to_xml
	  function.
	* www/list_foundationmembers.xsl: Correct links for paginator.

2008-06-22  Olav Vitters  <olav@bkor.dhs.org>

	* mango/models.py (AccountGroups): Ensure Account uid only consists of
	lowercase letters.

2008-06-22  Olav Vitters  <olav@bkor.dhs.org>

	* mango/models.py (Foundationmembers, FtpmirrorsForm,
	  FtpmirrorsForm.Meta, Users.groups, Users.add_to_xml): Correct the
	  Foundationmembers model. Add a FoundationmembersForm. Lastly, add a
	  add_to_xml function to the Users model.
	* mango/urls.py: Change accounts URL to requests. Also add the
	list_foundationmembers view.
	* mango/views.py (list_foundationmembers): Show foundation member
	details. Far from fully working.

2008-06-22  Olav Vitters  <olav@bkor.dhs.org>

	* mango/settings.py: Remove 'www' from hard coded URL.
	* mango/views.py (get_xmlresponse): Add 'www' to template location.
	* www/page.xsl: Add 'www' for the CSS. Update tab URLs to match Django
	install.

2008-06-22  Olav Vitters  <olav@bkor.dhs.org>

	* mango/views.py (get_xmldoc): Hard code the logged in user to me for
	now.

2008-06-22  Olav Vitters  <olav@bkor.dhs.org>

	* mango/models.py (Ftpmirrors): Active is a BooleanField.

2008-06-22  Olav Vitters  <olav@bkor.dhs.org>

	* mango/models.py (AccountRequest, AccountRequest.ault,
	  AccountRequest.ault, AccountRequest.ault, AccountGroups.ault,
	  Ftpmirrors, Ftpmirrors.Meta, Ftpmirrors.add_to_xml, FtpmirrorsForm,
	  FtpmirrorsForm.Meta, Webmirrors): Prevent some fields in various
	  models from being editable. Further, add an FtpmirrorsForm, based
	  upon Ftpmirrors model. Lastly, add an add_to_xml helper function to
	  the Ftpmirrors model.
	* mango/urls.py: Add new edit ftpmirror view.
	* mango/views.py (list_mirrors, edit_mirror): Create new view which
	allows an ftpmirror to be updated. Make list_mirrors view use
	add_to_xml helper function.
	* www/list_ftpmirrors.xsl: Update the link used to edit an ftpmirror.
	* www/update_ftpmirror.xsl: Add link back to list_mirrors view. Also
	make sure the POST goes to the right place.

2008-06-22  Olav Vitters  <olav@bkor.dhs.org>

	* mango/urls.py: Add list_mirrors view.
	* mango/views.py (list_mirrors): Fetch ftp mirrors from database,
	optionally filtering it by a keyword.

2008-06-22  Olav Vitters  <olav@bkor.dhs.org>

	* lib/ftpmirror.php (FTPMirror): variables / attributes / whatever
	should be public, not private.

2008-06-22  Olav Vitters  <olav@bkor.dhs.org>

	* www/list_users.xsl: Update links to Django clean urls.
	* www/update_user.xsl: Update links to Django clean urls.

2008-06-22  Olav Vitters  <olav@bkor.dhs.org>

	* mango/settings.py (ault): Hard code the base_url for now.
	* mango/views.py (get_xmlresponse, list_users, edit_user, test_index,
	  list_accounts): Make get_xmlresponse use base_url to provide a
	  reference to the XSLT template. Change existing usage of this
	  function to match changed functionality.

2008-06-22  Olav Vitters  <olav@bkor.dhs.org>

	* mango/views.py (edit_user): Make use of Users ldap helper class.
	Further, add group information to XML.

2008-06-22  Olav Vitters  <olav@bkor.dhs.org>

	* mango/models.py (UserGroups, Users, Users.__init__, Users.groups):
	Add UserGroups, representing an LDAP group. Make use of this group as
	a lazily initialized property within the Users group.

2008-06-22  Olav Vitters  <olav@bkor.dhs.org>

	* mango/views.py (list_users): Make use of new Users class.

2008-06-22  Olav Vitters  <olav@bkor.dhs.org>

	* mango/models.py (LdapObject): New class that can search for
	something in LDAP. Is not very smart atm.
	(Users): Uses LdapObject to store a user in.

2008-06-22  Olav Vitters  <olav@bkor.dhs.org>

	* mango/urls.py: Add new view 'edit_user'.
	* mango/views.py (edit_user): Add new view. Get uid information from
	ldap and give it to the template. Doesn't show everything in the
	template and also fails to do actually do anything.

2008-06-22  Olav Vitters  <olav@bkor.dhs.org>

	* mango/views.py (list_users): Return XML instead of debug text.
	For now, just add all LDAP users in the XML.

2008-06-21  Olav Vitters  <olav@bkor.dhs.org>

	* mango/models.py: Add LdapUtil singleton. Maintains a single
	connection to the LDAP database.
	* mango/views.py: Make use of the LDAP singleton.

2008-06-21  Olav Vitters  <olav@bkor.dhs.org>

	* mango/__init__.py: Add this file as well (moap didn't notice it).

2008-06-21  Olav Vitters  <olav@bkor.dhs.org>

	Try and port the mess to Python using the Django framework.

	* .bzrignore: Ignore the django directory.
	* mango/manage.py: Standard Django script to manage the Django
	project.
	* mango/models.py: Describes the Database (needs a bit of work).
	* mango/settings.py: Django settings and the config.xml file.
	* mango/urls.py: Maps URLs to functions which will be called.
	* mango/views.py: Handles turning an http request into an http
	response (application/xml).

2008-06-08  Olav Vitters  <olav@bkor.dhs.org>

	* lib/util.php: Correctly throw the Exception.

2008-06-03  Olav Vitters  <olav@bkor.dhs.org>

	* www/update_module.xsl: Don't allow the module name to be edited.
	LDAP doesn't support it.

2008-06-03  Olav Vitters  <olav@bkor.dhs.org>

	* www/update_module.xsl: Sort maintainers on full name and show
	userid.

2008-06-03  Olav Vitters  <olav@bkor.dhs.org>

	* www/update_module.xsl: Add link back to list_modules.php.

2008-06-03  Olav Vitters  <olav@bkor.dhs.org>

	* www/index.xsl: Add a focus function to the onload handler. The
	inline javascript executes way too early to do anything.
	* www/login.xsl: Add a focus function to the onload handler. The
	inline javascript executes way too early to do anything.

2008-06-03  Olav Vitters  <olav@bkor.dhs.org>

	* lib/module.php: Only provide current maintainers to the xml. Showing
	all users is not useful. Further, validate the given userids (should
	be done in a better way, but good enough for now).
	* www/update_module.xsl: Show checkboxes for the existing users and an
	input box to enter a new maintainer userid. Would be nice to be able
	to search for someones userid, but this is good enough.

2008-06-02  Olav Vitters  <olav@bkor.dhs.org>

	* www/update_user.php: Determine if an error message was shown last
	time. If so, the saving should be tried again; even if no change was
	made in the form.

2008-06-02  Olav Vitters  <olav@bkor.dhs.org>

	* lib/ber.php: Add BER decoder. Mango doesn't need it, but I thought
	it would, so let's just add it anyway.

2008-06-02  Olav Vitters  <olav@bkor.dhs.org>

	* lib/util.php: Parse the SSH public key data to determine the real
	bit length. Change the is_valid_ssh_pub_key function to give more
	feedback (array instead of just 'false').

	* lib/account.php: Adapt to is_valid_ssh_pub_key return changes.
	* lib/user.php: Adapt to is_valid_ssh_pub_key return changes.

2008-06-02  Olav Vitters  <olav@bkor.dhs.org>

	* templates/maintainer_approval.xsl: Add not about passwords.

2008-06-01  Olav Vitters  <olav@bkor.dhs.org>

	Try to avoid unknown people from requesting an account by hiding the
	new account link. Also ensure the examples refer to RSA, not DSA.

	* www/index.xsl:
	* www/login.xsl:
	* www/new_account.xsl:
	* www/new_user.xsl:
	* www/update_user.xsl:

2008-06-01  Olav Vitters  <olav@bkor.dhs.org>

	Fix loads of E_STRICT errors and convert a few things to PHP5 style
	classes.

	* lib/account.php:
	* lib/authtoken.php:
	* lib/foundationmember.php:
	* lib/ftpmirror.php:
	* lib/ldap.php:
	* lib/module.php:
	* lib/page.php:
	* lib/user.php:
	* www/common.php:
	* www/index.php:
	* www/list_accounts.php:
	* www/list_foundationmembers.php:
	* www/list_ftpmirrors.php:
	* www/list_modules.php:
	* www/list_users.php:
	* www/login.php:
	* www/new_account.php:
	* www/new_foundationmember.php:
	* www/new_ftpmirror.php:
	* www/new_module.php:
	* www/new_user.php:
	* www/update_foundationmember.php:
	* www/update_ftpmirror.php:
	* www/update_module.php:
	* www/update_user.php:

2008-06-01  Olav Vitters  <olav@bkor.dhs.org>

	Add configuration options for mail backend. Patch by Patrick Fey
	with slight modifications by me.

	* INSTALL: Document the new configuration options.
	* config.xml-gnome: Add new configuration options to example file.
	* lib/config.php: Add new config option. Olav: rewrite it to avoid
	repeating the same code plus convert to PHP5 class.

	* lib/util.php: Add send_mail function. Olav: slightly modified to
	avoid repeating the same code and only to set the mail params which
	have been set in the config.

	* lib/user.php: Make use of send_mail function.
	* www/list_foundationmembers.php: Make use of send_mail function.
	* www/new_foundationmember.php: Make use of send_mail function.
	* www/update_foundationmember.php: Make use of send_mail function.

	* lib/account.php: Pass account_email config option to the templates.
	Make use of send_mail function.
	* templates/authtoken_mail_verification.xsl: Use account_email.
	* templates/inform_accounts.xsl: Use account_email.
	* templates/maintainer_approval.xsl: Use account_email.
	* templates/requestor_status_change.xsl: Use account_email.

2008-06-01  Olav Vitters  <olav@bkor.dhs.org>

	* lib/page.php: Convert to PHP5 style object.

2008-06-01  Olav Vitters  <olav@bkor.dhs.org>

	* lib/mysql.php: Avoid notice when password is empty.
	* lib/user.php:
	* www/update_user.php: Complain loudly if user wasn't updated due to
	validation errors.

2008-06-01  Olav Vitters  <olav@bkor.dhs.org>

	* lib/util.php: Add array_same helper function.
	* www/update_user.php: Fix logic once again (PHP is weird). Further,
	check if the user was changed before attempting an update.

2008-06-01  Olav Vitters  <olav@bkor.dhs.org>

	* www/update_user.xsl: Ignore individual key additions and removals.
	* lib/user.php: Add _update_sshkey function and use it for SSH key
	removals and additions.

2008-06-01  Olav Vitters  <olav@bkor.dhs.org>

	* lib/user.php: Always check key length.
	* www/update_user.xsl: Show SSH key errors.

2008-06-01  Olav Vitters  <olav@bkor.dhs.org>

	* www/update_user.php: Ensure all attributes of a user are updated;
	meaning: if there are changes in the general section, the SSH keys
	should still receive updates as well.

2008-06-01  Olav Vitters  <olav@bkor.dhs.org>

	* www/update_user.xsl: Make SSH keys clickable.

2008-06-01  Olav Vitters  <olav@bkor.dhs.org>

	* www/update_user.php: Kill the tabs. They just make updating a user
	more annoying as not everything is on one page, plus you cannot switch
	between 'tabs' without saving the user.
	* www/update_user.xsl: Kill tabs in the UI as well.

2008-05-31  Olav Vitters  <olav@bkor.dhs.org>

	* www/update_user.php: PHP5 style object.

2008-05-31  Olav Vitters  <olav@bkor.dhs.org>

	* lib/user.php: Typo fix.
	* www/update_user.php: Remove savedkey handling. Just pass the entire
	key to the form, much easier.
	* www/update_user.xsl: Follow changes made above.

2008-05-31  Olav Vitters  <olav@bkor.dhs.org>

	* lib/user.php: Rework shell granting.

2008-05-31  Olav Vitters  <olav@bkor.dhs.org>

	* lib/user.php: Change to PHP5 style object.

2008-05-31  Olav Vitters  <olav@bkor.dhs.org>

	* lib/user.php: Rework the which_shell and which_homedir functions.
	They're still a bit stupid, but at least it is consistently stupid.
	* www/index.php: Set page title to 'Main page' when user is logged in.
	* www/page.xsl: Update copyright year.

2008-05-30  Olav Vitters  <olav@bkor.dhs.org>

	* docs/schemas/gnome.schema: Combination of below files, makes server
	configuration easier.
	* docs/schemas/cvs.schema:
	* docs/schemas/module.schema:
	* docs/schemas/sshd.schema:

2008-05-23  Olav Vitters  <olav@bkor.dhs.org>

	* templates/maintainer_approval.xsl: Fix typo. Patch by Patrick Fey.

2008-05-23  Olav Vitters  <olav@bkor.dhs.org>

	Allow membership committee to specify the GNOME userid for each
	foundation member.

	* docs/sql/foundationmembers.sql:
	* lib/foundationmember.php:
	* www/new_foundationmember.php:
	* www/new_foundationmember.xsl:
	* www/update_foundationmember.php:
	* www/update_foundationmember.xsl:

2008-05-22  Olav Vitters  <olav@bkor.dhs.org>

	* www/update_user.php: Allow changing of membership committee.
	* www/update_user.xsl: Make it valid XSLT.

2008-05-22  Olav Vitters  <olav@bkor.dhs.org>

	* www/update_user.xsl: Link back to the list_users.php and show the
	userid being edited.

2008-05-22  Olav Vitters  <olav@bkor.dhs.org>

	* www/update_user.xsl: Group the groups. Meaning: developer related
	groups together, foundation stuff together, etc.

2008-05-22  Olav Vitters  <olav@bkor.dhs.org>

	* lib/user.php: Only remove pubkeyAuthenticationUser if user currently
	has that object.

2008-05-22  Olav Vitters  <olav@bkor.dhs.org>

	* templates/user_instructions.xsl: Fix Danglish.

2008-05-22  Olav Vitters  <olav@bkor.dhs.org>

	* www/update_user.php: Add foundation membership group.
	* www/update_user.xsl:

2008-05-20  Olav Vitters  <olav@bkor.dhs.org>

	* templates/user_instructions.xsl: Whenever an SSH key is added,
	inform the user about *all* the SSH keys currently set on the account.
	Could be better, but oh well.

2008-05-20  Olav Vitters  <olav@bkor.dhs.org>

	* lib/user.php: Typo fix.
	* www/update_user.php: Allow the inform_user function to be ran.

2008-05-20  Olav Vitters  <olav@bkor.dhs.org>

	* lib/user.php:
	* templates/user_instructions.xsl: Inform the user regarding SSH key
	changes. Initial version.. untested.

2008-05-20  Olav Vitters  <olav@bkor.dhs.org>

	* lib/user.php:
	* templates/user_instructions.xsl:
	* www/new_user.php:
	* www/update_user.xsl: Prepare work to inform the user regarding key
	changes.

2008-05-17  Olav Vitters  <olav@bkor.dhs.org>

	* lib/user.php: When adding new SSH keys: Only add
	pubkeyAuthenticationUser objectclass if that objectclass is missing
	instead of assuming it isn't there if there aren't any SSH keys.
	Allows adding of SSH keys for people who had their SSH key removed due
	to Debian/Ubuntu SSH security issue.

2008-03-04  Olav Vitters  <olav@bkor.dhs.org>

	* lib/user.php: Don't validate uid again for users existing in LDAP.

2007-12-08  Olav Vitters  <olav@bkor.dhs.org>

	patch by: Patrick Fey

	* www/new_account.php: Catch ldap authentication error in
	new_account.php.

2007-12-08  Olav Vitters  <olav@bkor.dhs.org>

	patch by: Patrick Fey

	* lib/module.php: Eliminate useless generic ldap authentication error
	messages.

2007-12-08  Olav Vitters  <olav@bkor.dhs.org>

	reviewed by: <delete if not using a buddy>
	patch by: <delete if not someone else's patch>

	* www/new_account.php:

2007-12-08  Olav Vitters  <olav@bkor.dhs.org>

	patch by:  Patrick Fey

	* lib/ldap.php: Return error messages raised during connection to LDAP
	server. This was broken due to the switch to the singleton method.

2007-12-08  Olav Vitters  <olav@bkor.dhs.org>

	patch by: Patrick Fey

	* lib/ldap.php: Use ldap url instead of hostname to connect to ldap
	server.

2007-12-08  Olav Vitters  <olav@bkor.dhs.org>

	patch by:  Patrick Fey

	* docs/ldif/ou.ldif: Make docs/ou.ldif work out of the box

2007-12-08  Olav Vitters  <olav@bkor.dhs.org>

	patch by:  Patrick Fey

	* INSTALL: Improve installation instructions.

2007-12-04  Olav Vitters  <olav@bkor.dhs.org>

	* config.xml-gnome: Make it valid XML.

2007-11-27  Olav Vitters  <olav@bkor.dhs.org>

	* www/index.xsl: Stupid IE6 cannot approve SVN accounts due to missing
	action="$URL".

2007-11-17  Olav Vitters  <olav@bkor.dhs.org>

	* www/index.php: Show userid as well to allow maintainers to reject
	invalid userids.
	* www/index.xsl:

2007-11-11  Olav Vitters  <olav@bkor.dhs.org>

	* lib/account.php: Allow to select accounts in a status other than
	'S'. Filtering doesn't work yet.
	* www/list_accounts.php: Allow to reject accounts.
	* www/list_accounts.xsl:

2007-10-27  Olav Vitters  <olav@bkor.dhs.org>

	* www/verify_mail.xsl: Set libgo.channel.

2007-10-23  Olav Vitters  <olav@bkor.dhs.org>

	* www/page.xsl: Don't define libgo.channel twice.

2007-10-23  Olav Vitters  <olav@bkor.dhs.org>

	* www/index.xsl: Use correct attribute for the email address.

2007-10-20  Olav Vitters  <olav@bkor.dhs.org>

	* lib/account.php: Ensure multiple maintainers will be emailed.
	* lib/module.php:

2007-10-03  Olav Vitters  <olav@bkor.dhs.org>

	* templates/inform_accounts.xsl: Email address is now in <mail>; not
	in <email>.

2007-10-01  Olav Vitters  <olav@bkor.dhs.org>

	* lib/account.php: Don't allow usernames to consist of just one of the
	given names (first/last name).
	* www/list_foundationmembers.php: Only look at $_REQUEST['page'] if it is a number.
	* www/list_users.php: Only look at $_REQUEST['page'] if it is a number.

2007-09-29  Olav Vitters  <olav@bkor.dhs.org>

	* templates/inform_accounts.xsl: Ehr, forgot to add to the repos.

2007-09-28  Olav Vitters  <olav@bkor.dhs.org>

	* www/new_account.xsl: Sort the modules by name.

2007-09-28  Olav Vitters  <olav@bkor.dhs.org>

	* www/common.php: Don't cache any session data.
	* www/update_user.php: It is sendRedirect, not redirect.

2007-09-27  Olav Vitters  <olav@bkor.dhs.org>

	Fix wording so it look more like English.

	* lib/page.php:
	* templates/authtoken_mail_verification.xsl:
	* templates/maintainer_approval.xsl:
	* templates/requestor_status_change.xsl:
	* www/login.xsl:
	* www/new_account.xsl:
	* www/verify_mail.xsl:

2007-09-27  Olav Vitters  <olav@bkor.dhs.org>

	Be more paranoid.

	* lib/user.php: Check for valid user.
	* www/common.php: Change session settings to be more secure.
	* www/login.php:  Avoid session fixation attacks by use of
	session_regenerate_id.
	* www/new_user.php: Use update_status instead of obsolete
	update_verdict.

2007-09-26  Olav Vitters  <olav@bkor.dhs.org>

	Rewrite how the accounts are handled.

	* docs/sql/mango.sql:
	* lib/account.php:
	* lib/module.php:
	* lib/user.php:
	* templates/maintainer_approval.xsl:
	* www/index.php:
	* www/index.xsl:
	* www/list_accounts.php:
	* www/list_accounts.xsl:
	* www/new_account.php:
	* www/new_account.xsl:
	* www/verify_mail.php:
	* www/verify_mail.xsl:

2007-09-24  Olav Vitters  <olav@bkor.dhs.org>

	* lib/user.php: Don't check the key length. Too many existing users
	have too short keys for this to work.

2007-09-24  Olav Vitters  <olav@bkor.dhs.org>

	* www/update_user.php: Always run validate before updating the user.
	Further, avoid copy/paste code.

2007-09-23  Olav Vitters  <olav@bkor.dhs.org>

	* lib/account.php: Fix error in the email code. Every maintainer would
	always get an email, even if the request wasn't for them.

2007-09-23  Olav Vitters  <olav@bkor.dhs.org>

	* lib/util.php: Older ssh-keygens allowed DSA keys other than 1024
	bits. Allow everything with 1024 or more bits. Not sure if they'll
	allow a login though.

2007-09-23  Olav Vitters  <olav@bkor.dhs.org>

	Fix loads of errors by RATS and an evaluation version of Zend Studio.
	Unless specified otherwise, the fixes are for unused variables.

	* lib/account.php: Also don't use "" to surround regexps (should be
	''). Fix how _send_email is called.
	* lib/config.php:
	* lib/module.php:
	* lib/mysql.php:
	* lib/page.php:
	* lib/user.php: Also don't use "" to surround regexps (should be '').
	* www/list_accounts.php:
	* www/login.php:
	* www/new_account.php:
	* www/new_foundationmember.php:
	* www/new_ftpmirror.php:
	* www/new_module.php:
	* www/new_user.php:
	* www/update_foundationmember.php: Also use correct idcheck variable.
	* www/update_ftpmirror.php:
	* www/update_module.php:
	* www/update_user.php:

2007-09-23  Olav Vitters  <olav@bkor.dhs.org>

	* lib/user.php: Typo, causing emails not to go to the user.

2007-09-22  Olav Vitters  <olav@bkor.dhs.org>

	* lib/account.php: Update column names to match schema.

2007-09-22  Olav Vitters  <olav@bkor.dhs.org>

	* lib/foundationmember.php: Enable renew button as from 1 month before
	expiration.

2007-09-22  Olav Vitters  <olav@bkor.dhs.org>

	* docs/ldif/ou.ldif: Add required groups to the example LDIF file.
	Without these groups Mango will not function correctly.

2007-09-21  Olav Vitters  <olav@bkor.dhs.org>

	* lib/account.php: Validate SSH keys
	* www/new_account.php: Clear the stored SSH keys every time the form
	is read. Otherwise it isn't possible to not add certain SSH keys.
	Although this should at one point just use checkboxes.
	* www/new_account.xsl: Mention that requesters should read
	lgo/NewAccounts first.

2007-09-21  Olav Vitters  <olav@bkor.dhs.org>

	* lib/account.php: Load account data when the email address has been
	verified. This allows the maintainer approval email to contain
	information regarding the account request.
	Additionally, use better subjects for various emails.
	* lib/user.php: Use better subjects in the emails going to the GNOME
	account owner.
	* templates/maintainer_approval.xsl: Warn maintainers that they are
	responsible for the requester if they approve. Further, add details of
	requester to the mail.
	* lib/module.php: Remove debugging code.
	* lib/util.php: Enhance function to optionally return the fingerprint
	of the SSH key. This is basically just a MD5 of the base64 data.
	* www/list_foundationmembers.php: Remove debug code.
	* www/update_user.php: Show SSH key fingerprint, if available.
	* www/update_user.xsl: Show SSH key fingerprint, if available.

2007-09-21  Olav Vitters  <olav@bkor.dhs.org>

	* lib/account.php: Fix typo, causing the email address not to be
	checked properly (oops).

2007-09-21  Olav Vitters  <olav@bkor.dhs.org>

	* lib/user.php: Fix regression: Allowing to search by any attribute
	caused the groups to always appear as empty, due to wrong variable
	usage.

2007-09-21  Olav Vitters  <olav@bkor.dhs.org>

	* www/common.php (check_permissions): Prevent the page title from
	being shown when the user doesn't have enough permissions or is not
	logged in.

2007-09-20  Olav Vitters  <olav@bkor.dhs.org>

	New LDAP accounts and certain changes to existing accounts will
	automatically receive an email.

	* config.xml-gnome:
	* lib/account.php: Change debug config setting to mode setting.
	* lib/config.php: Get rid of debug. Mode has the same functionality.
	* lib/user.php (inform_user): New function to email the user of
	certain changes to the LDAP account (also for new account).
	* templates/user_instructions.xsl: Create emails for certain changes.
	Currently for new users and joining of ftpadmin/mailusers/gnomecvs.
	* templates/welcome_mail_alias.xsl: Email alias text has been merged
	with user_instructions.xsl. It is not possible to mail this manually
	anymore.
	* templates/welcome_mail_shell.xsl: Shell text has been merged with
	user_instructions.xsl. It is not possible to mail this manually
	anymore.
	* www/new_user.php: Call inform_user to send the welcome email.
	* www/update_user.php: Call inform_user to automatically inform the
	user. Get rid of the code that handles the obsolete instructions.
	* www/update_user.xsl: Get rid of the code that handles the obsolete
	instructions.

2007-09-20  Olav Vitters  <olav@bkor.dhs.org>

	Initial user creation from account request.

	* lib/account.php: (update_verdict): New function, updates the verdict
	column in the database. It will be 'approved' upon account creation
	and rejected otherwise. The latter still needs to be implemented.
	(fill_user): New function, fill in a user object instance from the
	fields in the account.
	* templates/requestor_status_change.xsl: Prevent unintended spaces in
	the email.
	* www/list_accounts.php: Add db_id to the XML, so we can link to
	new_user.php and mention the account id.
	* www/list_accounts.xsl: Link to new_user.php for the actual account
	creation.
	* www/new_user.php: Load an account instance when account parameter is
	used. Also check for this instance in adduser and update the account
	to approved using update_verdict.
	* www/new_user.xsl: Show when the SSH key has an error.

	* lib/util.php (is_valid_ssh_pub_key): DSA keys actually have ssh-dss
	as format specifier, not ssh-dsa.

2007-09-20  Olav Vitters  <olav@bkor.dhs.org>

	* lib/user.php (validate): Check if the given public SSH keys are valid.
	* lib/util.php (is_valid_ssh_pub_key): New function. Try to check if
	the public SSH key is valid. Even checks public key length for RSA.

2007-09-20  Olav Vitters  <olav@bkor.dhs.org>

	* www/new_user.php: Fix annoying bug where new_user.php wouldn't
	remember the existing SSH keys. This could happen if e.g. there was an
	error shown and you tried to create the account again.

2007-09-20  Olav Vitters  <olav@bkor.dhs.org>

	* lib/account.php (validate): Check if email address hasn't been used
	by an existing account in LDAP.
	* lib/user.php (fetchuser): Allow it to fetch a user by any LDAP
	attribute, defaulting to uid. This will take the first user returned,
	even if there are multiple.
	
	* www/new_account.xsl: Order the abilities to have the most commonly
	requested abilities at the top, and another section for infrequently
	requested abilities. Also change simplify the language a bit.

2007-09-20  Olav Vitters  <olav@bkor.dhs.org>

	* lib/account.php (validate): Add more checks to check if the given
	account is really valid. Meaning: don't allow a username/email address
	if there already is an account request for it. 

2007-09-19  Olav Vitters  <olav@bkor.dhs.org>

	* lib/user.php: Don't add a gecos field. It doesn't accept UTF-8, we
	never update it, and the tools that look at gecos (getent passwd
	$USER) seem to fall back on cn anyway. Fixes bug #432270.

2007-09-19  Olav Vitters  <olav@bkor.dhs.org>

	* lib/account.php: When fetching the authorizationkeys from the
	database, split it again on "\n". This as it should always be an
	array.

2007-09-19  Olav Vitters  <olav@bkor.dhs.org>

	* lib/account.php: Inform account owner regarding status changes.
	Also correct how _send_email is called (bug in previous commit).

	* templates/requestor_status_change.xsl: Add first draft of status
	change template. This template explains to the requestor what the
	status change means (next steps). The 'rejected' state could probably
	be friendlier.

2007-09-19  Olav Vitters  <olav@bkor.dhs.org>

	* lib/account.php: (_send_email): Create _send_email function and make
	a lot of code use that instead of the copy/paste way that seemed to be
	used. If debug mode is on, send the emails to the support address.
	(_create_email): Put mode and baseurl config settings as attributes of
	the root node. This so email templates can reference the site URL.

	* lib/module.php: Don't echo the module changes in debug mode.
	* lib/mysql.php: Don't echo the SQL in debug mode.
	* templates/maintainer_approval.xsl: Make baseurl work in the
	email (see _create_email change).
	* www/verify_mail.xsl: Add hack to avoid the email address from
	popping up in the HTML. No idea on the real cause, but added an empty
	'email' to avoid it.

2007-09-19  Olav Vitters  <olav@bkor.dhs.org>

	* INSTALL: Expand on the installation section by suggesting that .xsl
	files should get cache instructions.
	* lib/page.php: Let the browser do the work of transforming the XML
	into HTML. This works for Firefox, IE.

2007-09-11  Olav Vitters  <olav@bkor.dhs.org>

	* lib/account.php: Add more input validation (more needed still).

2007-09-11  Olav Vitters  <olav@bkor.dhs.org>

	* lib/page.php: Make debugxml param work.
	* www/list_accounts.php: Remove commented out code.
	* www/login.php: Make login.php automatically rediect if already
	logged in (not only just after logging in).

2007-09-11  Olav Vitters  <olav@bkor.dhs.org>

	* templates/authtoken_mail_verification.xsl: Don't use more than 72
	width.
	* templates/maintainer_approval.xsl: Better explain the process to the
	maintainer.

2007-09-11  Olav Vitters  <olav@bkor.dhs.org>

	* lib/ldap.php: Singleton fixes.

	* lib/module.php: Make use of LDAP singleton.
	* lib/user.php:
	* www/list_modules.php:
	* www/list_users.php:
	* www/new_account.xsl:

2007-09-11  Olav Vitters  <olav@bkor.dhs.org>

	* lib/mysql.php: Use singleton per database URL.

	* lib/account.php: Change files to use MySQL singleton.
	* lib/foundationmember.php:
	* lib/ftpmirror.php:
	* www/list_foundationmembers.php:
	* www/list_ftpmirrors.php:

2007-09-09  Olav Vitters  <olav@bkor.dhs.org>

	* www/list_accounts.php: Use User::fetchuser to determine who approved
	the request.

2007-09-09  Olav Vitters  <olav@bkor.dhs.org>

	* lib/account.php: Fix which column name is used to determine SVN
	module (gnomemodule, not svn_access).
	* www/new_account.php: Fix errors preventing accounts to be requested.
	* www/new_account.xsl: Only show the form input when it is a new
	request, or there was an error with the old one. Hide the error when
	the request has been submitted (before).

2007-09-09  Olav Vitters  <olav@bkor.dhs.org>

	* lib/ldap.php: Add LDAP escape function and make use of it.
	* lib/module.php:
	* lib/user.php:
	* www/list_modules.php:
	* www/list_users.php:
	* www/login.php:
	* www/page.xsl:
	* www/update_user.php:

2007-09-09  Olav Vitters  <olav@bkor.dhs.org>

	* www/index.xsl: Show same form as login.xsl.
	* www/list_accounts.xsl: Fix English.
	* www/skin/default.css: De-uglify a bit.

2007-09-09  Olav Vitters  <olav@bkor.dhs.org>

	* www/index.xsl: Fix XML validation error.
	* www/login.php: Redirect to the main page after logging in.

2007-09-09  Olav Vitters  <olav@bkor.dhs.org>

	* lib/page.php:
	* www/common.php:
	* www/index.xsl:
	* www/login.xsl:
	* www/new_account.xsl:
	* www/new_foundationmember.xsl:
	* www/new_ftpmirror.xsl:
	* www/new_module.xsl:
	* www/new_user.xsl:
	* www/update_foundationmember.xsl:
	* www/update_ftpmirror.xsl:
	* www/update_module.xsl:
	* www/update_user.xsl: Protect against CSRF, but only the POSTs. See
	http://en.wikipedia.org/wiki/Cross-site_request_forgery.

2007-09-09  Olav Vitters  <olav@bkor.dhs.org>

	Merge SoC changes r16:41 on the trunk.

2007-06-24  Olav Vitters  <olav@bkor.dhs.org>

	* lib/user.php: Validate uid (1-12 chars of a-z; no caps). Validate
	email address (regexp taken from Bugzilla).

2006-10-10  Ross Golder  <ross@golder.org>
	
	* lib/authtoken.php: Added.
	* lib/mysql.php: Minor variable renaming.
	* lib/page.php: Remove unnecessary warning/error suppression.
	* lib/config.php: Also check for '/var/www/mango/config.xml'.
	* lib/foundationmember.php: No need for 'emaillink' stuff.
	* www/*.xsl, www/default.css: Cosmetic updates.
	* www/list_users.php: Unified/simplified filter keyword search.
	* www/update_user.php: Broke into tabs and added form to assist in
	  sending of templated e-mails.
	* templates/authtoken_mail.xsl: Added.
	* templates/welcome_mail.xsl: Added.

2005-12-11  Ross Golder  <ross@golder.org>
	
	* www/page.xsl, www/*user*.php: Added access for members of the
	  'accounts' group.

2005-09-29  Ross Golder  <ross@golder.org>
	
	* lib/user.php: Setting SSH key(s) and group(s) wasn't working
	  when adding a new user.

2005-09-28  Ross Golder  <ross@golder.org>
	
	* lib/user.php: Added 'which_homedir' function.
	* lib/user.php: Added 'which_shell' function.

2005-08-30  Ross Golder  <ross@golder.org>
	
	* www/update_user.xsl, www/new_user.xsl: Re-arrange order of auth
	  key upload/textarea. Added link to update from 'user added' message.
	* www/update_user.php, www/new_user.xsl: De-duplicate keys and ignore
	  empty keys.
	* www/new_user.php, lib/users.php: Fixed uploading SSH keys when
	  adding new users.
	* lib/users.php: Add/remove 'pubkeyAuthenticationUser' class as necessary.
	* lib/users.php: Add/remove homedirectory and shell as necessary (on
	  joining/leaving ftpadmin group).
	* lib/users.php: Lowered high watermark for fetching next UID to 10000 to
	  stop it creating users with insanely high UIDs.

2005-08-28  Ross Golder  <ross@golder.org>
	
	* www/list_users.php: Fix bad re-use of $node variable.
	* www/default.css: Add 'tr.inactive' class selector.
	* lib/foundationmember.php: Added 'first_added' field.
	* lib/datefield.php: New utility class.
	* lib/paged_results.php: Fixed bad re-use of $node variable.
	* lib/mysql.php: New date-escaping functions.
	* bin/convert_members.csv.py: The script I used to convert the
	  CSV data Vincent supplied with the original membership.
	* sql/foundationmembers.sql: Added to complement Vuntz's data and
	  scripts for foundation membership management.
	* sql/ftpmirrors.sql: Added for reference.
	* config.xml: No need for this under version control - there's a template
	  version there anyway.
	* lib/config.php: Add 'session_path' config variable (for CGI use).
	* www/index.php, www/login.php: Use 'common.php' like the rest.

2005-08-24  Ross Golder  <ross@golder.org>

	* www/*.php: Add shebangs as page scripts are to be CGI-executable.

2005-08-17  Ross Golder  <ross@golder.org>

	* www/page.xsl, www/login.xsl: Added links to foundation membership
	  scripts for sysadmin and 'vuntz' groupies :)

2005-08-17  Vincent Untz  <vuntz@gnome.org>

	* lib/foundationmember.php, www/*foundationmember*.[php|xsl]: New
	  stuff for managing the foundation members database.

2005-08-01  Ross Golder  <ross@golder.org>

	* www/new_user.*: Add ability to upload SSH key (copied from
	  update page).
	* lib/user.php: Fixed a bug where lastname was added as description.
	* secure/login.*: Moved to 'www/'. We're gonna host it all on https.
	* secure/: Redundant, removed.
	* www/index.xsl, www/page.xsl: Replaced 'secureurl' links with 'baseurl'
	  links.
	* www/login.xsl, lib/config.php, lib/page.php: Removed traces of
	  'secureurl'.
	* www/page.xsl: Fix broken 'mirrors' link at top of each page.
	* www/list_ftpmirrors.*: Made filter apply to useful fields.
	* www/lists.xml: New file for storing static lists.
	* www/new_ftpmirror.xsl, www/update_ftpmirror.xsl: Made location
	  field a listbox, usins lists.xml.
	  
2005-07-29  Ross Golder  <ross@golder.org>

	* secure/common.xsl: Replaced testing URL with live one.
	* www/update_user.xsl: Truncate displayed SSH keys for comfort.

2005-07-28  Ross Golder  <ross@golder.org>

	* Created initial ChangeLog.
	* Added 'redirect' argument to login/page to save a click or two.


