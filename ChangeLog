2007-09-21  Olav Vitters  <olav@bkor.dhs.org>

	* lib/user.php: Fix regression: Allowing to search by any attribute
	caused the groups to always appear as empty, due to wrong variable
	usage.

2007-09-21  Olav Vitters  <olav@bkor.dhs.org>

	* www/common.php (check_permissions): Prevent the page title from
	being shown when the user doesn't have enough permissions or is not
	logged in.

2007-09-20  Olav Vitters  <olav@bkor.dhs.org>

	New LDAP accounts and certain changes to existing accounts will
	automatically receive an email.

	* config.xml-gnome:
	* lib/account.php: Change debug config setting to mode setting.
	* lib/config.php: Get rid of debug. Mode has the same functionality.
	* lib/user.php (inform_user): New function to email the user of
	certain changes to the LDAP account (also for new account).
	* templates/user_instructions.xsl: Create emails for certain changes.
	Currently for new users and joining of ftpadmin/mailusers/gnomecvs.
	* templates/welcome_mail_alias.xsl: Email alias text has been merged
	with user_instructions.xsl. It is not possible to mail this manually
	anymore.
	* templates/welcome_mail_shell.xsl: Shell text has been merged with
	user_instructions.xsl. It is not possible to mail this manually
	anymore.
	* www/new_user.php: Call inform_user to send the welcome email.
	* www/update_user.php: Call inform_user to automatically inform the
	user. Get rid of the code that handles the obsolete instructions.
	* www/update_user.xsl: Get rid of the code that handles the obsolete
	instructions.

2007-09-20  Olav Vitters  <olav@bkor.dhs.org>

	Initial user creation from account request.

	* lib/account.php: (update_verdict): New function, updates the verdict
	column in the database. It will be 'approved' upon account creation
	and rejected otherwise. The latter still needs to be implemented.
	(fill_user): New function, fill in a user object instance from the
	fields in the account.
	* templates/requestor_status_change.xsl: Prevent unintended spaces in
	the email.
	* www/list_accounts.php: Add db_id to the XML, so we can link to
	new_user.php and mention the account id.
	* www/list_accounts.xsl: Link to new_user.php for the actual account
	creation.
	* www/new_user.php: Load an account instance when account parameter is
	used. Also check for this instance in adduser and update the account
	to approved using update_verdict.
	* www/new_user.xsl: Show when the SSH key has an error.

	* lib/util.php (is_valid_ssh_pub_key): DSA keys actually have ssh-dss
	as format specifier, not ssh-dsa.

2007-09-20  Olav Vitters  <olav@bkor.dhs.org>

	* lib/user.php (validate): Check if the given public SSH keys are valid.
	* lib/util.php (is_valid_ssh_pub_key): New function. Try to check if
	the public SSH key is valid. Even checks public key length for RSA.

2007-09-20  Olav Vitters  <olav@bkor.dhs.org>

	* www/new_user.php: Fix annoying bug where new_user.php wouldn't
	remember the existing SSH keys. This could happen if e.g. there was an
	error shown and you tried to create the account again.

2007-09-20  Olav Vitters  <olav@bkor.dhs.org>

	* lib/account.php (validate): Check if email address hasn't been used
	by an existing account in LDAP.
	* lib/user.php (fetchuser): Allow it to fetch a user by any LDAP
	attribute, defaulting to uid. This will take the first user returned,
	even if there are multiple.
	
	* www/new_account.xsl: Order the abilities to have the most commonly
	requested abilities at the top, and another section for infrequently
	requested abilities. Also change simplify the language a bit.

2007-09-20  Olav Vitters  <olav@bkor.dhs.org>

	* lib/account.php (validate): Add more checks to check if the given
	account is really valid. Meaning: don't allow a username/email address
	if there already is an account request for it. 

2007-09-19  Olav Vitters  <olav@bkor.dhs.org>

	* lib/user.php: Don't add a gecos field. It doesn't accept UTF-8, we
	never update it, and the tools that look at gecos (getent passwd
	$USER) seem to fall back on cn anyway. Fixes bug #432270.

2007-09-19  Olav Vitters  <olav@bkor.dhs.org>

	* lib/account.php: When fetching the authorizationkeys from the
	database, split it again on "\n". This as it should always be an
	array.

2007-09-19  Olav Vitters  <olav@bkor.dhs.org>

	* lib/account.php: Inform account owner regarding status changes.
	Also correct how _send_email is called (bug in previous commit).

	* templates/requestor_status_change.xsl: Add first draft of status
	change template. This template explains to the requestor what the
	status change means (next steps). The 'rejected' state could probably
	be friendlier.

2007-09-19  Olav Vitters  <olav@bkor.dhs.org>

	* lib/account.php: (_send_email): Create _send_email function and make
	a lot of code use that instead of the copy/paste way that seemed to be
	used. If debug mode is on, send the emails to the support address.
	(_create_email): Put mode and baseurl config settings as attributes of
	the root node. This so email templates can reference the site URL.

	* lib/module.php: Don't echo the module changes in debug mode.
	* lib/mysql.php: Don't echo the SQL in debug mode.
	* templates/maintainer_approval.xsl: Make baseurl work in the
	email (see _create_email change).
	* www/verify_mail.xsl: Add hack to avoid the email address from
	popping up in the HTML. No idea on the real cause, but added an empty
	'email' to avoid it.

2007-09-19  Olav Vitters  <olav@bkor.dhs.org>

	* INSTALL: Expand on the installation section by suggesting that .xsl
	files should get cache instructions.
	* lib/page.php: Let the browser do the work of transforming the XML
	into HTML. This works for Firefox, IE.

2007-09-11  Olav Vitters  <olav@bkor.dhs.org>

	* lib/account.php: Add more input validation (more needed still).

2007-09-11  Olav Vitters  <olav@bkor.dhs.org>

	* lib/page.php: Make debugxml param work.
	* www/list_accounts.php: Remove commented out code.
	* www/login.php: Make login.php automatically rediect if already
	logged in (not only just after logging in).

2007-09-11  Olav Vitters  <olav@bkor.dhs.org>

	* templates/authtoken_mail_verification.xsl: Don't use more than 72
	width.
	* templates/maintainer_approval.xsl: Better explain the process to the
	maintainer.

2007-09-11  Olav Vitters  <olav@bkor.dhs.org>

	* lib/ldap.php: Singleton fixes.

	* lib/module.php: Make use of LDAP singleton.
	* lib/user.php:
	* www/list_modules.php:
	* www/list_users.php:
	* www/new_account.xsl:

2007-09-11  Olav Vitters  <olav@bkor.dhs.org>

	* lib/mysql.php: Use singleton per database URL.

	* lib/account.php: Change files to use MySQL singleton.
	* lib/foundationmember.php:
	* lib/ftpmirror.php:
	* www/list_foundationmembers.php:
	* www/list_ftpmirrors.php:

2007-09-09  Olav Vitters  <olav@bkor.dhs.org>

	* www/list_accounts.php: Use User::fetchuser to determine who approved
	the request.

2007-09-09  Olav Vitters  <olav@bkor.dhs.org>

	* lib/account.php: Fix which column name is used to determine SVN
	module (gnomemodule, not svn_access).
	* www/new_account.php: Fix errors preventing accounts to be requested.
	* www/new_account.xsl: Only show the form input when it is a new
	request, or there was an error with the old one. Hide the error when
	the request has been submitted (before).

2007-09-09  Olav Vitters  <olav@bkor.dhs.org>

	* lib/ldap.php: Add LDAP escape function and make use of it.
	* lib/module.php:
	* lib/user.php:
	* www/list_modules.php:
	* www/list_users.php:
	* www/login.php:
	* www/page.xsl:
	* www/update_user.php:

2007-09-09  Olav Vitters  <olav@bkor.dhs.org>

	* www/index.xsl: Show same form as login.xsl.
	* www/list_accounts.xsl: Fix English.
	* www/skin/default.css: De-uglify a bit.

2007-09-09  Olav Vitters  <olav@bkor.dhs.org>

	* www/index.xsl: Fix XML validation error.
	* www/login.php: Redirect to the main page after logging in.

2007-09-09  Olav Vitters  <olav@bkor.dhs.org>

	* lib/page.php:
	* www/common.php:
	* www/index.xsl:
	* www/login.xsl:
	* www/new_account.xsl:
	* www/new_foundationmember.xsl:
	* www/new_ftpmirror.xsl:
	* www/new_module.xsl:
	* www/new_user.xsl:
	* www/update_foundationmember.xsl:
	* www/update_ftpmirror.xsl:
	* www/update_module.xsl:
	* www/update_user.xsl: Protect against CSRF, but only the POSTs. See
	http://en.wikipedia.org/wiki/Cross-site_request_forgery.

2007-09-09  Olav Vitters  <olav@bkor.dhs.org>

	Merge SoC changes r16:41 on the trunk.

2007-06-24  Olav Vitters  <olav@bkor.dhs.org>

	* lib/user.php: Validate uid (1-12 chars of a-z; no caps). Validate
	email address (regexp taken from Bugzilla).

2006-10-10  Ross Golder  <ross@golder.org>
	
	* lib/authtoken.php: Added.
	* lib/mysql.php: Minor variable renaming.
	* lib/page.php: Remove unnecessary warning/error suppression.
	* lib/config.php: Also check for '/var/www/mango/config.xml'.
	* lib/foundationmember.php: No need for 'emaillink' stuff.
	* www/*.xsl, www/default.css: Cosmetic updates.
	* www/list_users.php: Unified/simplified filter keyword search.
	* www/update_user.php: Broke into tabs and added form to assist in
	  sending of templated e-mails.
	* templates/authtoken_mail.xsl: Added.
	* templates/welcome_mail.xsl: Added.

2005-12-11  Ross Golder  <ross@golder.org>
	
	* www/page.xsl, www/*user*.php: Added access for members of the
	  'accounts' group.

2005-09-29  Ross Golder  <ross@golder.org>
	
	* lib/user.php: Setting SSH key(s) and group(s) wasn't working
	  when adding a new user.

2005-09-28  Ross Golder  <ross@golder.org>
	
	* lib/user.php: Added 'which_homedir' function.
	* lib/user.php: Added 'which_shell' function.

2005-08-30  Ross Golder  <ross@golder.org>
	
	* www/update_user.xsl, www/new_user.xsl: Re-arrange order of auth
	  key upload/textarea. Added link to update from 'user added' message.
	* www/update_user.php, www/new_user.xsl: De-duplicate keys and ignore
	  empty keys.
	* www/new_user.php, lib/users.php: Fixed uploading SSH keys when
	  adding new users.
	* lib/users.php: Add/remove 'pubkeyAuthenticationUser' class as necessary.
	* lib/users.php: Add/remove homedirectory and shell as necessary (on
	  joining/leaving ftpadmin group).
	* lib/users.php: Lowered high watermark for fetching next UID to 10000 to
	  stop it creating users with insanely high UIDs.

2005-08-28  Ross Golder  <ross@golder.org>
	
	* www/list_users.php: Fix bad re-use of $node variable.
	* www/default.css: Add 'tr.inactive' class selector.
	* lib/foundationmember.php: Added 'first_added' field.
	* lib/datefield.php: New utility class.
	* lib/paged_results.php: Fixed bad re-use of $node variable.
	* lib/mysql.php: New date-escaping functions.
	* bin/convert_members.csv.py: The script I used to convert the
	  CSV data Vincent supplied with the original membership.
	* sql/foundationmembers.sql: Added to complement Vuntz's data and
	  scripts for foundation membership management.
	* sql/ftpmirrors.sql: Added for reference.
	* config.xml: No need for this under version control - there's a template
	  version there anyway.
	* lib/config.php: Add 'session_path' config variable (for CGI use).
	* www/index.php, www/login.php: Use 'common.php' like the rest.

2005-08-24  Ross Golder  <ross@golder.org>

	* www/*.php: Add shebangs as page scripts are to be CGI-executable.

2005-08-17  Ross Golder  <ross@golder.org>

	* www/page.xsl, www/login.xsl: Added links to foundation membership
	  scripts for sysadmin and 'vuntz' groupies :)

2005-08-17  Vincent Untz  <vuntz@gnome.org>

	* lib/foundationmember.php, www/*foundationmember*.[php|xsl]: New
	  stuff for managing the foundation members database.

2005-08-01  Ross Golder  <ross@golder.org>

	* www/new_user.*: Add ability to upload SSH key (copied from
	  update page).
	* lib/user.php: Fixed a bug where lastname was added as description.
	* secure/login.*: Moved to 'www/'. We're gonna host it all on https.
	* secure/: Redundant, removed.
	* www/index.xsl, www/page.xsl: Replaced 'secureurl' links with 'baseurl'
	  links.
	* www/login.xsl, lib/config.php, lib/page.php: Removed traces of
	  'secureurl'.
	* www/page.xsl: Fix broken 'mirrors' link at top of each page.
	* www/list_ftpmirrors.*: Made filter apply to useful fields.
	* www/lists.xml: New file for storing static lists.
	* www/new_ftpmirror.xsl, www/update_ftpmirror.xsl: Made location
	  field a listbox, usins lists.xml.
	  
2005-07-29  Ross Golder  <ross@golder.org>

	* secure/common.xsl: Replaced testing URL with live one.
	* www/update_user.xsl: Truncate displayed SSH keys for comfort.

2005-07-28  Ross Golder  <ross@golder.org>

	* Created initial ChangeLog.
	* Added 'redirect' argument to login/page to save a click or two.


